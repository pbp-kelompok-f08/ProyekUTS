{% load static %}
<nav class="fixed top-0 left-0 z-50 w-full bg-[#1C1C1C] border-b border-[#2A2A2A] text-[#EAEAEA] flex items-center justify-between px-6 md:px-10 py-4 shadow-[0_2px_6px_rgba(0,0,0,0.6)]">
  <!-- Left: Logo -->
  <div class="text-3xl font-bold tracking-wider" style="font-family: 'Roboto Mono', monospace;">
    hoppin<span class="text-gray-500">.</span>
  </div>

  <!-- Hamburger Button (Mobile) -->
  <button id="menu-btn" class="md:hidden flex flex-col justify-center items-center space-y-1 focus:outline-none">
    <span class="block w-6 h-[2px] bg-[#EAEAEA] rounded"></span>
    <span class="block w-6 h-[2px] bg-[#EAEAEA] rounded"></span>
    <span class="block w-6 h-[2px] bg-[#EAEAEA] rounded"></span>
  </button>

  <!-- Navigation Links (Desktop + Mobile) -->
  <div id="menu"
       class="hidden md:flex flex-col md:flex-row absolute md:static top-full left-0 w-full md:w-auto bg-[#1C1C1C] md:bg-transparent border-t md:border-0 border-[#2A2A2A] md:space-x-10 text-gray-400 text-lg font-medium md:items-center"
       style="font-family: 'Roboto Mono', monospace;">
       
    <a href="/threads/"
       class="block px-6 py-3 md:p-0 transition-all duration-300 relative group {% if request.path == '/threads/' %}text-white{% endif %}">
      Home
      <span class="absolute left-0 bottom-1 md:bottom-[-4px] h-[2px] bg-white transition-all duration-300
        {% if request.path == '/threads/' %}w-full{% else %}w-0 group-hover:w-full{% endif %}">
      </span>
    </a>

    <a href="/booking-venue/"
       class="block px-6 py-3 md:p-0 transition-all duration-300 relative group {% if '/booking-venue' in request.path %}text-white{% endif %}">
      Venue
      <span class="absolute left-0 bottom-1 md:bottom-[-4px] h-[2px] bg-white transition-all duration-300
        {% if '/booking-venue' in request.path %}w-full{% else %}w-0 group-hover:w-full{% endif %}">
      </span>
    </a>

    <a href="/matches/"
       class="block px-6 py-3 md:p-0 transition-all duration-300 relative group {% if request.path == '/matches/' %}text-white{% endif %}">
      Match
      <span class="absolute left-0 bottom-1 md:bottom-[-4px] h-[2px] bg-white transition-all duration-300
        {% if request.path == '/matches/' %}w-full{% else %}w-0 group-hover:w-full{% endif %}">
      </span>
    </a>

    <a href="/liveChat/"
       class="block px-6 py-3 md:p-0 transition-all duration-300 relative group {% if '/liveChat' in request.path %}text-white{% endif %}">
      Chat
      <span class="absolute left-0 bottom-1 md:bottom-[-4px] h-[2px] bg-white transition-all duration-300
        {% if '/liveChat' in request.path %}w-full{% else %}w-0 group-hover:w-full{% endif %}">
      </span>
    </a>

    {% if user.is_authenticated %}
      <!-- Divider (only mobile) -->
      <div class="border-t border-[#2A2A2A] my-2 md:hidden"></div>
      <!-- Mobile user menu -->
      <a href="{% url 'accounts:dashboard' %}" class="block px-6 py-3 md:hidden hover:bg-[#2A2A2A] text-white transition">
        Dashboard
      </a>
      <a href="/profile/" class="block px-6 py-3 md:hidden hover:bg-[#2A2A2A] text-white transition">
        Profile
      </a>
      <button onclick="logoutUser()" class="block w-full text-left px-6 py-3 md:hidden hover:bg-[#2A2A2A] text-white transition">
        Logout
      </button>
    {% endif %}
  </div>

  <!-- Right: User Menu (Desktop only) -->
  <div class="hidden md:flex items-center space-x-4">
    {% if user.is_authenticated %}
      <div class="flex items-center space-x-3">
        <span class="text-sm text-gray-300">Welcome, {{ user.username }}</span>
        <div class="relative">
          <button id="user-menu-btn" class="w-10 h-10 flex items-center justify-center border border-[#3A3A3A] rounded-full overflow-hidden hover:border-[#5A5A5A] transition duration-300 shadow-md hover:shadow-gray-700/40">
            {% if user.profile_picture and user.profile_picture.url %}
              <img src="{{ user.profile_picture.url }}" alt="{{ user.username }}'s avatar" class="w-full h-full object-cover">
            {% else %}
              <img src="{% static 'accounts/img/default.png' %}" alt="Default avatar" class="w-full h-full object-cover">
            {% endif %}
          </button>

          <!-- Dropdown Menu (Desktop) -->
          <div id="user-dropdown" class="absolute right-0 mt-2 w-48 bg-[#1C1C1C] border border-[#2A2A2A] rounded-lg shadow-lg py-2 hidden z-50">
            <a href="{% url 'accounts:dashboard' %}" class="block px-4 py-2 text-sm text-[#EAEAEA] hover:bg-[#2A2A2A] transition-colors">
              Dashboard
            </a>
            <a href="/profile/" class="block px-4 py-2 text-sm text-[#EAEAEA] hover:bg-[#2A2A2A] transition-colors">
              Profile
            </a>
            <div class="border-t border-[#2A2A2A] my-1"></div>
            <button onclick="logoutUser()" class="block w-full text-left px-4 py-2 text-sm text-[#EAEAEA] hover:bg-[#2A2A2A] transition-colors">
              Logout
            </button>
          </div>
        </div>
      </div>
    {% else %}
      <div class="flex items-center space-x-3">
        <a href="/login/" class="text-[#EAEAEA] hover:text-white transition-colors font-medium">Login</a>
        <a href="/register/" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">Sign Up</a>
      </div>
    {% endif %}
  </div>
</nav>

<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@500;600&display=swap" rel="stylesheet">

<script>
  // Toggle hamburger menu
  const btn = document.getElementById('menu-btn');
  const menu = document.getElementById('menu');
  btn.addEventListener('click', () => {
    menu.classList.toggle('hidden');
    menu.classList.toggle('flex');
  });

  // User dropdown toggle
  const userMenuBtn = document.getElementById('user-menu-btn');
  const userDropdown = document.getElementById('user-dropdown');

  if (userMenuBtn && userDropdown) {
    userMenuBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      userDropdown.classList.toggle('hidden');
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', () => {
      userDropdown.classList.add('hidden');
    });
  }

  // Logout function
  function logoutUser() {
    fetch('/accounts/ajax/logout/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': getCookie('csrftoken')
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        window.location.href = '/login/';
      }
    })
    .catch(error => {
      console.error('Logout error:', error);
      window.location.href = '/login/';
    });
  }

  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
</script>
